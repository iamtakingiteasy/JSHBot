#!/bin/sh

prefix="devenv"

doLink() {
	from="$1"; shift
	to="$1"; shift
	
	if [ ! -e "$to" ]; then
		echo "Linking $to"
		ln -s "$from" "$to"
	fi
}

find "$JSHBOT_ROOT/distribution/target/distribution-1.0-SNAPSHOT-distro/distribution-1.0-SNAPSHOT/distribution" -type f | 
	sed 's|.*distribution/||;' | 
		while read line; do 
			outdir="${line%/*}"
			bname="${line##*/}"
			name="${bname%.*}"
			mkdir -p "$prefix/$outdir"
			if echo $line | grep -q "^bundles/lib"; then 
				doLink "$JSHBOT_ROOT/distribution/target/distribution-1.0-SNAPSHOT-distro/distribution-1.0-SNAPSHOT/distribution/$line" "$prefix/$outdir/$name.jar"
			else 
				if [ "${line%%/*}" = "core" ]; then
					p="$HOME/.m2/repository/org/eientei/jshbot/bundles/${line%/*}/$name/1.0-SNAPSHOT/$name-1.0-SNAPSHOT.jar"
				else
					p="$HOME/.m2/repository/org/eientei/jshbot/${line%/*}/$name/1.0-SNAPSHOT/$name-1.0-SNAPSHOT.jar"
				fi
				doLink "$p" "$prefix/$outdir/$name.jar"
			fi
		done
